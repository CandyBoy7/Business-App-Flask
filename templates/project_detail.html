{% extends "base.html" %}

{% block title %}í”„ë¡œì íŠ¸ ìƒì„¸: {{ project.title }}{% endblock %}

{% block content %}
    
    <h2>ğŸ“‹ í”„ë¡œì íŠ¸: {{ project.title }}</h2>
    <p>ì„¤ëª…: {{ project.description }}</p>
    
    <hr>
    
    <div style="margin-bottom: 20px; display: flex; gap: 10px;">
        <a href="{{ url_for('edit_project', project_id=project.id) }}" class="btn" style="background-color: #f39c12; color: white;">
            ğŸ“ í”„ë¡œì íŠ¸ ìˆ˜ì •
        </a>

        <form method="POST" action="{{ url_for('delete_project', project_id=project.id) }}" 
              onsubmit="return confirm('ê²½ê³ ! í”„ë¡œì íŠ¸ì™€ ëª¨ë“  í•  ì¼ì´ ì˜êµ¬ì ìœ¼ë¡œ ì‚­ì œë©ë‹ˆë‹¤. ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?');">
            <button type="submit" class="btn" style="background-color: #e74c3c; color: white;">
                âŒ í”„ë¡œì íŠ¸ ì‚­ì œ
            </button>
        </form>
    </div>

    <div style="background-color: #e9ecef; padding: 10px; border-radius: 5px; margin-bottom: 20px;">
        <strong>ğŸ“Š ì§„í–‰ë¥ :</strong> <span style="font-weight: bold; color: #007bff;">{{ completion_rate }}</span>
    </div>

    <h3>âœ… í•  ì¼ ëª©ë¡</h3>
    
    <form method="POST" action="{{ url_for('add_task', project_id=project.id) }}" style="display: flex; gap: 10px; margin-bottom: 20px;">
        <input type="text" name="content" placeholder="ìƒˆ í•  ì¼ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”" required style="flex-grow: 1;">
        
        <select name="priority" style="padding: 10px; border: 1px solid #ccc; border-radius: 4px; white-space: nowrap;">
            <option value="1">ì¤‘ìš”ë„: ë‚®ìŒ</option>
            <option value="2">ì¤‘ìš”ë„: ë³´í†µ</option>
            <option value="3">ì¤‘ìš”ë„: ë†’ìŒ</option>
        </select>
        
        <input type="date" name="due_date" style="padding: 10px; border: 1px solid #ccc; border-radius: 4px;">

        <button type="submit" class="btn btn-primary" style="padding: 10px 15px; white-space: nowrap;">í•  ì¼ ì¶”ê°€</button>
    </form>
    
    {% if tasks %}
        <ul class="task-list">
            {% for task in tasks %}
                <li class="task-item">
                    <span class="content-text" style="text-decoration: {% if task.is_complete %}line-through; color: #777;{% else %}none; color: black;{% endif %};">
                        
                        {% if task.priority == 3 %}
                            <span style="color: white; background-color: #e74c3c; padding: 2px 6px; border-radius: 3px; font-size: 0.75em; margin-right: 5px;">ğŸ”¥ ë†’ìŒ</span>
                        {% elif task.priority == 2 %}
                            <span style="color: white; background-color: #f39c12; padding: 2px 6px; border-radius: 3px; font-size: 0.75em; margin-right: 5px;">âš ï¸ ë³´í†µ</span>
                        {% else %}
                            <span style="color: white; background-color: #3498db; padding: 2px 6px; border-radius: 3px; font-size: 0.75em; margin-right: 5px;">ğŸ’¡ ë‚®ìŒ</span>
                        {% endif %}
                        
                        {{ task.content }} 
                        
                        <small style="color: #999;">
                            ({{ task.date_posted.strftime('%Y-%m-%d') }})
                            {% if task.due_date %}
                                | ë§ˆê°ì¼: {{ task.due_date.strftime('%Y-%m-%d') }}
                            {% endif %}
                        </small>
                    </span>
                    
                    <div class="actions">
                        <form method="POST" action="{{ url_for('complete_task', task_id=task.id) }}" style="display: inline;">
                            <button type="submit" 
                                    class="btn" 
                                    style="padding: 5px 10px; font-size: 0.8em; 
                                           background-color: {% if task.is_complete %}#f39c12{% else %}#2ecc71{% endif %}; 
                                           color: white;">
                                {% if task.is_complete %}ë¯¸ì™„ë£Œ{% else %}âœ… ì™„ë£Œ{% endif %}
                            </button>
                        </form>
                        
                        <button type="button" 
                                class="btn edit-btn" 
                                onclick="document.getElementById('edit-form-{{ task.id }}').style.display='block'" 
                                style="padding: 5px 10px; font-size: 0.8em; background-color: #3498db; color: white;">
                            âœï¸ ìˆ˜ì •
                        </button>
                        
                        <form method="POST" action="{{ url_for('delete_task', task_id=task.id) }}" style="display: inline;" onsubmit="return confirm('ì •ë§ë¡œ ì´ í•  ì¼ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?');">
                            <button type="submit" 
                                    class="btn" 
                                    style="padding: 5px 10px; font-size: 0.8em; 
                                           background-color: #e74c3c; 
                                           color: white;">
                                âŒ ì‚­ì œ
                            </button>
                        </form>
                    </div>
                </li>
                
                <div id="edit-form-{{ task.id }}" style="display: none; background: #f0f0f0; padding: 15px; border-radius: 5px; margin-top: 10px; margin-bottom: 20px; border: 1px solid #ccc;">
                    <form method="POST" action="{{ url_for('edit_task', task_id=task.id) }}" style="display: flex; flex-direction: column; gap: 10px;">
                        
                        <input type="text" name="content" value="{{ task.content }}" required style="padding: 8px;">
                        
                        <div style="display: flex; gap: 10px;">
                            <select name="priority" style="padding: 8px; flex-grow: 1;">
                                <option value="1" {% if task.priority == 1 %}selected{% endif %}>ì¤‘ìš”ë„: ë‚®ìŒ</option>
                                <option value="2" {% if task.priority == 2 %}selected{% endif %}>ì¤‘ìš”ë„: ë³´í†µ</option>
                                <option value="3" {% if task.priority == 3 %}selected{% endif %}>ì¤‘ìš”ë„: ë†’ìŒ</option>
                            </select>
                            
                            <input type="date" name="due_date" 
                                   value="{{ task.due_date.strftime('%Y-%m-%d') if task.due_date else '' }}" 
                                   style="padding: 8px; flex-grow: 1;">
                        </div>

                        <div style="display: flex; gap: 10px;">
                            <button type="submit" class="btn" style="background-color: #2ecc71; color: white; flex-grow: 1;">ìˆ˜ì • ì™„ë£Œ</button>
                            <button type="button" class="btn" onclick="document.getElementById('edit-form-{{ task.id }}').style.display='none'" style="background-color: #95a5a6; color: white;">ì·¨ì†Œ</button>
                        </div>
                    </form>
                </div>
            {% endfor %}
        </ul>
    {% else %}
        <p>ì´ í”„ë¡œì íŠ¸ì—ëŠ” ì•„ì§ í•  ì¼ì´ ì—†ìŠµë‹ˆë‹¤. ìƒˆë¡œìš´ í•  ì¼ì„ ì¶”ê°€í•´ ë³´ì„¸ìš”!</p>
    {% endif %}

    <hr>
    <a href="{{ url_for('list_projects') }}">â†©ï¸ í”„ë¡œì íŠ¸ ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>
{% endblock %}